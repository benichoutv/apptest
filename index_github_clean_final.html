<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BNC TV - Carte Moderne Glow</title>
  <link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root { --app-bg: #f8f8f6; }
    body { font-family: 'Montserrat', Arial, sans-serif; margin: 0; background: var(--app-bg);}
    header { background: rgba(0, 0, 0, 0.5); color: white; display: flex; align-items: center; justify-content: center; padding: 20px; height: 100px; backdrop-filter: blur(6px); position: sticky; top: 0; z-index: 999;}
    header img { height: 180px; max-width: 100%; }
    #admin-panel { background: white; padding: 20px; display: none; border-bottom: 1px solid #ccc; max-width: 640px; margin: 20px auto; border-radius: 18px; box-shadow: 0 2px 14px rgba(0,0,0,0.06);}
    #admin-panel input, #admin-panel button, #admin-panel textarea { display: block; margin: 10px 0; padding: 8px; width: 100%; font-family: inherit; font-size: 1em;}
    .services-group, .specialities-group { display: flex; gap: 18px; margin: 14px 0 0 0; align-items: center;}
    .service-checkbox-label, .speciality-checkbox-label { display: flex; align-items: center; font-size: 1em; gap: 6px; font-weight: 600; letter-spacing: 1px; color: #444;}
    .speciality-checkbox-label span { font-size:1.4em;}
    #admin-posts-list > div { display:flex; align-items:center; gap:10px; margin-bottom:8px; border-bottom:1px solid #eee; padding-bottom:6px;}
    #admin-posts-list img { width:48px; height:48px; object-fit:cover; border-radius:6px;}
    #admin-posts-list button { width:auto; padding:4px 8px; margin:0 2px; font-size:0.93em;}
    #posts { padding: 40px 10px 40px 10px; display: flex; flex-direction: column; gap: 34px; background: var(--app-bg); min-height: 100vh; align-items: center;}
    
    .post:hover {
      box-shadow:
        0 0 0 10px rgba(80,180,255,0.16),
        0 12px 64px 0 rgba(40,100,230,0.21),
        0 32px 100px 0 rgba(0,0,0,0.19),
        0 0 44px 0 rgba(110,180,255,0.24);
      transform: translateY(-4px) scale(1.021);
    }
    .post-img { width: 210px; height: 210px; object-fit: cover; border-radius: 22px; background: #eee; box-shadow: 0 3px 12px rgba(0,0,0,0.07); flex-shrink: 0; margin-right: 6px;}
    
    .desc-short { font-family: 'Anton', Impact, Arial Black, Arial, sans-serif; font-size: 2.4em; font-weight: 700; color: #1c1c1c; margin: 0 0 10px 0; text-transform: uppercase; letter-spacing: 1px; word-break: break-word; line-height: 1.05;}
    .desc-long { font-size: 1.14em; color: #444; margin-bottom: 10px;}
    .specialities-row { margin:7px 0 8px 0; display: flex; align-items: center; gap: 11px; }
    .specialities-label { font-weight:bold; color:#106088; margin-right: 6px; font-size: 1.08em;}
    .speciality-ico { font-size: 1.6em; padding: 0 3px; vertical-align: middle; }
    .services-badges { display: flex; gap: 13px; flex-wrap: wrap; margin-top: 5px; margin-bottom: 10px; align-items: center;}
    .service-badge { display: flex; align-items: center; gap: 7px; background: linear-gradient(90deg, #50b4ff 0%, #aee8fe 100%); color: #025075; border-radius: 17px; font-size: 1.03em; padding: 6px 19px 6px 15px; font-weight: bold; border: none; box-shadow: 0 1px 6px rgba(80,160,220,0.08); letter-spacing: 0.5px; text-transform: uppercase; line-height: 1.2;}
    .service-badge[data-service="Surplace"] { background: linear-gradient(90deg, #53e19b 0%, #d4ffe2 100%); color: #025c41;}
    .service-badge[data-service="Envoi"] { background: linear-gradient(90deg, #ffe082 0%, #fff7d1 100%); color: #866200;}
    .service-ico { font-size: 1.2em; margin-right: 2px;}
    .dept-labels { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; margin-top: 7px;}
    .dept-labels-title { font-size: 1.04em; color: #1a2536; font-weight: bold; margin-right: 8px; letter-spacing: 0.2px;}
    .dept-badge { display: inline-block; background: #ffe1a8; color: #352c00; border-radius: 14px; font-size: 1.1em; padding: 5px 18px 5px 18px; font-weight: bold; border: none; letter-spacing: 1px; box-shadow: 0 1px 5px rgba(140,120,60,0.05);}
    .links {
      margin-top: 25px;
      display: flex;
      gap: 14px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: flex-start;
    }
    .actions-label {
      font-weight:700;
      font-size:1.07em;
      color:#0a7cff;
      margin-right:10px;
      align-self:flex-start;
      letter-spacing:1px;
    }
    .links a {
      background: linear-gradient(90deg, #0a7cff 40%, #44a6ff 100%);
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 12px 22px;
      font-size: 1.08em;
      font-weight: bold;
      text-transform: uppercase;
      box-shadow: 0 2px 8px rgba(10,90,255,0.07);
      transition: background 0.13s, transform 0.13s, box-shadow 0.13s;
      cursor: pointer;
      outline: none;
      text-decoration: none;
      letter-spacing: 1px;
      margin-bottom: 2px;
      display: inline-block;
    }
    .links a:hover {
      background: linear-gradient(90deg, #005bbf 30%, #228be6 100%);
      transform: translateY(-2px) scale(1.04);
      box-shadow: 0 6px 18px rgba(44,140,255,0.12);
      color: #fff;
    }
    .modal { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 1000;}
    .modal-content { background: white; padding: 30px 24px 24px 24px; max-width: 580px; width: 96vw; border-radius: 20px; position: relative; box-shadow: 0 6px 32px rgba(0,0,0,0.14); text-align: left;}
    .modal-content img { max-width: 100%; border-radius: 14px; margin-bottom: 20px;}
    .modal-close { position: absolute; top: 12px; right: 14px; background: #d43c3c; color: white; border: none; border-radius: 5px; padding: 7px 12px; cursor: pointer; font-size: 1.1em; font-weight: 700; z-index: 1; box-shadow: 0 2px 8px rgba(0,0,0,0.11);}
    @media (max-width: 950px) {  .post-img {margin-right: 0;}  .desc-short {font-size: 1.7em;} #admin-panel {padding: 10px;} }
    @media (max-width: 540px) { .post-img {width: 96vw; max-width: 340px; height: 40vw; min-height: 120px;}  .dept-badge, .service-badge {font-size: 0.98em; padding: 6px 13px;} }
  
.post {
  display: flex;
  flex-direction: row;
  align-items: flex-start;
  gap: 16px;
  padding: 16px;
  margin: 16px auto;
  background-color: white;
  border-radius: 14px;
  box-shadow: 0 4px 16px rgba(0,0,0,0.08);
  max-width: 720px;
  width: 100%;
}

.post img {
  width: 240px;
  height: 240px;
  object-fit: cover;
  border-radius: 12px;
  flex-shrink: 0;
}

.post-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  font-size: 15px;
}

.post-content p {
  margin: 4px 0;
}

.post .post-actions {
  margin-top: 10px;
}

.post .post-actions button {
  padding: 6px 12px;
  font-size: 14px;
  border-radius: 6px;
  background-color: #1da1f2;
  color: white;
  border: none;
}

@media screen and (max-width: 600px) {
  .post {
    flex-direction: column;
    align-items: stretch;
  }

  .post img {
    width: 100%;
    height: auto;
    border-radius: 12px 12px 0 0;
  }

  .post-content {
    padding-top: 10px;
  }
}

</style>
</head>
<body>
  <header>
    <img id="header-logo" src="bnctv.png" alt="BNC TV" />
  </header>
  <div style="padding: 10px 20px; max-width:800px;margin:auto;">
    <input type="text" id="filterDept" placeholder="Filtrer par département (ex: 75, 13)" oninput="renderPosts(this.value)" style="width:100%;max-width:280px;padding:8px;font-size:1em;border-radius:8px;border:1px solid #bbb;">
  </div>
  
  
          <button onclick="deletePost(${i})" style="color:red">Supprimer</button>
        `;
        list.appendChild(div);
      });
    }

    function editPost(i) {
      const post = posts[i];
      document.getElementById("editIndex").value = i;
      document.getElementById("descInput").value = post.desc;
      document.getElementById("longDescInput").value = post.longDesc || "";
      document.getElementById("departementInput").value = post.dept || "";
      document.getElementById("serviceLivraison").checked = post.services?.includes("Livraison") || false;
      document.getElementById("serviceSurplace").checked = post.services?.includes("Surplace") || false;
      document.getElementById("serviceEnvoi").checked = post.services?.includes("Envoi") || false;
      document.getElementById("specFlocon").checked = post.specialities?.includes("Flocon") || false;
      document.getElementById("specBrocoli").checked = post.specialities?.includes("Brocoli") || false;
      document.getElementById("specChocolat").checked = post.specialities?.includes("Chocolat") || false;
      document.getElementById("specPilule").checked = post.specialities?.includes("Pilule") || false;
      post.links.forEach((l, idx) => {
        document.getElementById(`link${idx+1}name`).value = l.name;
        document.getElementById(`link${idx+1}url`).value = l.url;
      });
      for (let j = post.links.length+1; j <= 3; j++) {
        document.getElementById(`link${j}name`).value = "";
        document.getElementById(`link${j}url`).value = "";
      }
    }

    function deletePost(i) {
      if (!confirm("Supprimer ce post ?")) return;
      posts.splice(i, 1);
      localStorage.setItem("bnctv_posts", JSON.stringify(posts));
    updateStorageInfo();
      renderPosts();

function fullResetStorage() {
  if (confirm("Cette action va supprimer tous les posts, les paramètres de couleur. Continuer ?")) {
    localStorage.clear();
    posts = [];
    renderPosts();
    renderAdminPosts();
    updateStorageInfo();
    alert("Stockage entièrement vidé.");
  }
}

updateStorageInfo();

function formatBytes(bytes) {
  if (bytes === 0) return '0 o';
  const k = 1024;
  const sizes = ['o', 'Ko', 'Mo', 'Go'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

function updateStorageInfo() {
  let total = 0;
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    const value = localStorage.getItem(key);
    total += key.length + value.length;
  }
  // Les navigateurs comptent souvent 1 char = 2 bytes
  const estimatedBytes = total * 2;
  const display = formatBytes(estimatedBytes);
  const el = document.getElementById("used-space");
  if (el) el.textContent = display;
}


function resizeImage(file, callback) {
  const reader = new FileReader();
  reader.onload = function (e) {
    const img = new Image();
    img.onload = function () {
      const canvas = document.createElement("canvas");
      const maxW = 800;
      const maxH = 800;
      let w = img.width;
      let h = img.height;
      if (w > h) {
        if (w > maxW) { h *= maxW / w; w = maxW; }
      } else {
        if (h > maxH) { w *= maxH / h; h = maxH; }
      }
      canvas.width = w;
      canvas.height = h;
      const ctx = canvas.getContext("2d");
      ctx.drawImage(img, 0, 0, w, h);
      callback(canvas.toDataURL("image/jpeg", 0.7)); // qualité 70%
    };
    img.src = e.target.result;
  };
  reader.readAsDataURL(file);
}

      renderAdminPosts();
    }

    function resetAdminForm() {
      document.getElementById("editIndex").value = "";
      document.getElementById("descInput").value = "";
      document.getElementById("longDescInput").value = "";
      document.getElementById("departementInput").value = "";
      document.getElementById("imageInput").value = "";
      document.getElementById("serviceLivraison").checked = false;
      document.getElementById("serviceSurplace").checked = false;
      document.getElementById("serviceEnvoi").checked = false;
      document.getElementById("specFlocon").checked = false;
      document.getElementById("specBrocoli").checked = false;
      document.getElementById("specChocolat").checked = false;
      document.getElementById("specPilule").checked = false;
      for (let i = 1; i <= 3; i++) {
        document.getElementById(`link${i}name`).value = "";
        document.getElementById(`link${i}url`).value = "";
      }
    }

    function getServiceIcon(service) {
      if (service === "Livraison") return `<span class="service-ico">🚚</span>`;
      if (service === "Surplace") return `<span class="service-ico">🍽️</span>`;
      if (service === "Envoi") return `<span class="service-ico">📦</span>`;
      return "";
    }
    function getSpecialityIcon(spec) {
      if (spec === "Flocon") return `<span class="speciality-ico">❄️</span>`;
      if (spec === "Brocoli") return `<span class="speciality-ico">🥦</span>`;
      if (spec === "Chocolat") return `<span class="speciality-ico">🍫</span>`;
      if (spec === "Pilule") return `<span class="speciality-ico">💊</span>`;
      return "";
    }
    function renderPosts(filter = "") {
      const container = document.getElementById("posts");
      container.innerHTML = "";
      posts.forEach((post) => {
        const depts = post.dept?.split(',').map(d => d.trim()) || [];
        if (filter && filter.trim() !== "" && !depts.includes(filter.trim())) return;
        const div = document.createElement("div");
        div.className = "post";
        div.onclick = () => showPostDetail(post);
        div.innerHTML = `
          <img src="${post.image}" alt="image" class="post-img">
          <div class="post-content">
            <div class="desc-short">${post.desc}</div>
            <div class="desc-long">${post.longDesc || ''}</div>
            ${post.specialities && post.specialities.length ? `
              <div class="specialities-row">
                <span class="specialities-label">Spécialité(s):</span>
                ${post.specialities.map(s => getSpecialityIcon(s)).join('')}
              </div>
            ` : ''}
            ${post.services && post.services.length ? `
              <div class="services-badges">
                ${post.services.map(s => `<span class="service-badge" data-service="${s}">${getServiceIcon(s)}${s}</span>`).join('')}
              </div>
            ` : ''}
            ${post.dept ? `
              <div class="dept-labels">
                <span class="dept-labels-title">Départements :</span>
                ${post.dept.split(',').map(d => `<span class="dept-badge">${d.trim()}</span>`).join('')}
              </div>
            ` : ''}
            ${post.links && post.links.length ? `
              <div class="links">
                <span class="actions-label">Actions :</span>
                ${post.links.map(l => `<a href="${l.url}" target="_blank" onclick="event.stopPropagation()">${l.name}</a>`).join("")}
              </div>
            ` : ''}
          </div>
        `;
        container.appendChild(div);
      });
    }
    function showPostDetail(post) {
      const modal = document.getElementById("postModal");
      const content = document.getElementById("modalContent");
      content.innerHTML = `
        <button class="modal-close" onclick="closeModal()">Fermer</button>
        <img src="${post.image}" alt="image">
        <div class="desc-short">${post.desc}</div>
        <div class="desc-long">${post.longDesc || ''}</div>
        ${post.specialities && post.specialities.length ? `
          <div class="specialities-row">
            <span class="specialities-label">Spécialité(s):</span>
            ${post.specialities.map(s => getSpecialityIcon(s)).join('')}
          </div>
        ` : ''}
        ${post.services && post.services.length ? `
          <div class="services-badges" style="margin: 7px 0 0 0;">
            ${post.services.map(s => `<span class="service-badge" data-service="${s}">${getServiceIcon(s)}${s}</span>`).join('')}
          </div>
        ` : ''}
        ${post.dept ? `
          <div class="dept-labels" style="margin-top:13px;">
            <span class="dept-labels-title">Départements :</span>
            ${post.dept.split(',').map(d => `<span class="dept-badge">${d.trim()}</span>`).join('')}
          </div>
        ` : ''}
        ${post.links && post.links.length ? `
          <div class="links" style="margin-top:15px;">
            <span class="actions-label">Actions :</span>
            ${post.links.map(l => `<a href="${l.url}" target="_blank">${l.name}</a>`).join("")}
          </div>
        ` : ''}
      `;
      modal.style.display = "flex";
    }
    function closeModal() {
      document.getElementById("postModal").style.display = "none";
    }
    function loadSettings() {
            const savedBg = localStorage.getItem("bnctv_bgcolor");
      if (savedBg) document.documentElement.style.setProperty("--app-bg", savedBg);
    }
    loadSettings();
    renderPosts();

function fullResetStorage() {
  if (confirm("Cette action va supprimer tous les posts, les paramètres de couleur. Continuer ?")) {
    localStorage.clear();
    posts = [];
    renderPosts();
    renderAdminPosts();
    updateStorageInfo();
    alert("Stockage entièrement vidé.");
  }
}

updateStorageInfo();

function formatBytes(bytes) {
  if (bytes === 0) return '0 o';
  const k = 1024;
  const sizes = ['o', 'Ko', 'Mo', 'Go'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

function updateStorageInfo() {
  let total = 0;
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    const value = localStorage.getItem(key);
    total += key.length + value.length;
  }
  // Les navigateurs comptent souvent 1 char = 2 bytes
  const estimatedBytes = total * 2;
  const display = formatBytes(estimatedBytes);
  const el = document.getElementById("used-space");
  if (el) el.textContent = display;
}


function resizeImage(file, callback) {
  const reader = new FileReader();
  reader.onload = function (e) {
    const img = new Image();
    img.onload = function () {
      const canvas = document.createElement("canvas");
      const maxW = 800;
      const maxH = 800;
      let w = img.width;
      let h = img.height;
      if (w > h) {
        if (w > maxW) { h *= maxW / w; w = maxW; }
      } else {
        if (h > maxH) { w *= maxH / h; h = maxH; }
      }
      canvas.width = w;
      canvas.height = h;
      const ctx = canvas.getContext("2d");
      ctx.drawImage(img, 0, 0, w, h);
      callback(canvas.toDataURL("image/jpeg", 0.7)); // qualité 70%
    };
    img.src = e.target.result;
  };
  reader.readAsDataURL(file);
}


function clearLocalStorage() {
  if (confirm("Confirmer la suppression de tous les posts enregistrés ?")) {
    localStorage.removeItem("bnctv_posts");
    updateStorageInfo();
    localStorage.removeItem("bnctv_logo");
    localStorage.removeItem("bnctv_bgcolor");
    posts = [];
    renderPosts();

function fullResetStorage() {
  if (confirm("Cette action va supprimer tous les posts, les paramètres de couleur. Continuer ?")) {
    localStorage.clear();
    posts = [];
    renderPosts();
    renderAdminPosts();
    updateStorageInfo();
    alert("Stockage entièrement vidé.");
  }
}

updateStorageInfo();

function formatBytes(bytes) {
  if (bytes === 0) return '0 o';
  const k = 1024;
  const sizes = ['o', 'Ko', 'Mo', 'Go'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

function updateStorageInfo() {
  let total = 0;
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    const value = localStorage.getItem(key);
    total += key.length + value.length;
  }
  // Les navigateurs comptent souvent 1 char = 2 bytes
  const estimatedBytes = total * 2;
  const display = formatBytes(estimatedBytes);
  const el = document.getElementById("used-space");
  if (el) el.textContent = display;
}


function resizeImage(file, callback) {
  const reader = new FileReader();
  reader.onload = function (e) {
    const img = new Image();
    img.onload = function () {
      const canvas = document.createElement("canvas");
      const maxW = 800;
      const maxH = 800;
      let w = img.width;
      let h = img.height;
      if (w > h) {
        if (w > maxW) { h *= maxW / w; w = maxW; }
      } else {
        if (h > maxH) { w *= maxH / h; h = maxH; }
      }
      canvas.width = w;
      canvas.height = h;
      const ctx = canvas.getContext("2d");
      ctx.drawImage(img, 0, 0, w, h);
      callback(canvas.toDataURL("image/jpeg", 0.7)); // qualité 70%
    };
    img.src = e.target.result;
  };
  reader.readAsDataURL(file);
}

    renderAdminPosts();
    alert("Stockage local vidé.");
  }
}

  </script>
</body>
</html>
